-- ATUALIZAÇÃO DE UM ORÇAMENTO NA TABELA TAB_PROJETO
UPDATE TAB_PROJETO
SET ORCAMENTO = 210000
WHERE COD_PROJETO = 'P0001';


--  CRIAÇÃO DE UMA TABELA TESTE PARA CRIAÇÃO DE UMA TRIGGER PARA INSERÇÃO DE DADOS ADQUIRIDOS EM UM JOIN
CREATE TABLE TAB_DEPARTAMENTO_TESTE(
    DEPARTAMENTO VARCHAR(20) NULL,
    TOTAL FLOAT
);



/*  CRIAÇÃO DA TRIGGER  QUE INSERE OS REGISTRO RETORNADOS DE UMA CONSULTA COM INNER JOINS  ENTRE 3 TABELAS
PARA A TABELA TG_TAB_DEPARTAMENTO_TESTE COM O NOME DO DEPARTAMENTO E SEU ORÇAMENTO POR FUNCIONARIO
*/
CREATE TRIGGER TG_TAB_DEPARTAMENTO_TESTE
AFTER INSERT OR UPDATE OR DELETE ON TAB_PROJETO
    BEGIN
        DELETE FROM TAB_DEPARTAMENTO_TESTE;
        INSERT INTO TAB_DEPARTAMENTO_TESTE
        SELECT
            DP.NOME_DEPARTAMENTO,
            ROUND(SUM(TP.ORCAMENTO)/COUNT(F.COD_FUNCIONARIO),2) AS ORCAMENTO_POR_FUNCIONARIO
        FROM TAB_DEPARTAMENTO DP
        INNER JOIN TAB_FUNCIONARIO F
            ON DP.COD_DEPARTAMENTO = F.COD_DEPARTAMENTO
        INNER JOIN TAB_PROJETO TP
            ON DP.COD_DEPARTAMENTO = TP.COD_DEPARTAMENTO
        GROUP BY DP.NOME_DEPARTAMENTO;
    END;
    

